apiVersion: v1
data:
  custom_bootstrap.json: "\"staticResources\":\n{\n  \"listeners\":\n  [\n    {\n
    \   \"address\": {\n      \"socketAddress\": {\n      \"address\": \"0.0.0.0\",\n
    \     \"portValue\": 1080\n    }\n    },\n    \"filterChains\":\n    [\n      {\n
    \       \"filters\":\n        [\n          {\n            \"name\": \"envoy.filters.network.http_connection_manager\",\n
    \           \"typedConfig\": \n            {\n              \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager\",\n
    \             \"statPrefix\": \"customauth\",\n              \"routeConfig\":
    {\n               \"name\": \"local_route\",\n               \"virtual_hosts\":
    [\n                 {\n                  \"name\": \"service\",\n                  \"domains\":
    [\n                    \"*\"\n                  ],\n                  \"routes\":
    [\n                    {\n                     \"match\": {\n                       \"prefix\":
    \"/\"\n                     },\n                     \"route\": {\n                       \"cluster\":
    \"local_service\"\n                     }\n                    }\n                  ]\n
    \                }\n               ]\n              }\n             ,\n              \"httpFilters\":
    \n              [\n                {\n                  \"name\": \"istio.basic_auth\",\n
    \                 \"typed_config\": {\n                    \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n
    \                   \"type_url\": \"type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm\",\n
    \                   \"value\": {\n                      \"config\": {\n                        \"configuration\":
    {\n                          \"@type\": \"type.googleapis.com/google.protobuf.StringValue\",\n
    \                         \"value\": \"{\\n  \\\"basic_auth_rules\\\": [\\n    {\\n
    \     \\\"prefix\\\": \\\"/productpage\\\",\\n      \\\"request_methods\\\":[
    \\\"GET\\\", \\\"POST\\\" ],\\n      \\\"credentials\\\":[ \\\"ok:test\\\", \\\"YWRtaW4zOmFkbWluMw==\\\"
    ]\\n    }\\n  ]\\n}\\n\"\n                        },\n                        \"vm_config\":
    {\n                          \"vm_id\": \"basic_auth\",\n                          \"code\":
    {\n                            \"local\": {\n                              \"filename\":
    \"/var/opt/basic-auth.wasm\"\n                            }\n                          },\n
    \                         \"runtime\": \"envoy.wasm.runtime.v8\"\n                        }\n
    \                     }\n                    }\n                  }\n                },\n
    \               {\n                  \"name\": \"envoy.filters.http.router\",\n
    \                 \"typedConfig\": {\n                    \"@type\": \"type.googleapis.com/envoy.extensions.filters.http.router.v3.Router\"\n
    \                 }\n                }\n              ]\n            }\n          }\n
    \       ]\n      }\n    ]\n    }\n  ],\n  \"clusters\": [\n    {\n        \"name\":
    \"local_service\",\n        \"type\": \"STATIC\",\n        \"lb_policy\": \"ROUND_ROBIN\",\n
    \       \"loadAssignment\": {\n            \"clusterName\": \"local_service\",\n
    \           \"endpoints\": [\n                {\n                    \"lbEndpoints\":
    [\n                        {\n                            \"endpoint\": {\n                                \"address\":
    {\n                                    \"socketAddress\": {\n                                        \"address\":
    \"127.0.0.1\",\n                                        \"portValue\": 9080\n
    \                                   }\n                                }\n                            }\n
    \                       }\n                    ]\n                }\n            ]\n
    \       }\n    },\n    {\n        \"name\": \"remote_wasm\",\n        \"type\":
    \"STRICT_DNS\",\n        \"connect_timeout\": \"1s\",\n        \"dns_refresh_rate\":
    \"5s\",\n        \"dns_lookup_family\": \"v4_only\",\n        \"load_assignment\":
    {\n          \"cluster_name\": \"remote_wasm\",\n          \"endpoints\": [\n
    \           {\n              \"lb_endpoints\": [\n                {\n                  \"endpoint\":
    {\n                    \"address\": {\n                      \"socket_address\":
    {\n                        \"address\": \"github.com\",\n                        \"port_value\":
    443\n                      }\n                    }\n                  }\n                }\n
    \             ]\n            }\n          ]\n        },\n        \"transport_socket\":
    {\n          \"name\": \"envoy.transport_sockets.tls\",\n          \"typed_config\":
    {\n            \"@type\": \"type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext\",\n
    \           \"sni\": \"github.com\"\n          }\n        }\n      }\n    ]\n}\n"
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","data":{"custom_bootstrap.json":"\"staticResources\":\n{\n  \"listeners\":\n  [\n    {\n    \"address\": {\n      \"socketAddress\": {\n      \"address\": \"0.0.0.0\",\n      \"portValue\": 1080\n    }\n    },\n    \"filterChains\":\n    [\n      {\n        \"filters\":\n        [\n          {\n            \"name\": \"envoy.filters.network.http_connection_manager\",\n            \"typedConfig\": \n            {\n              \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager\",\n              \"statPrefix\": \"customauth\",\n              \"routeConfig\": {\n               \"name\": \"local_route\",\n               \"virtual_hosts\": [\n                 {\n                  \"name\": \"service\",\n                  \"domains\": [\n                    \"*\"\n                  ],\n                  \"routes\": [\n                    {\n                     \"match\": {\n                       \"prefix\": \"/\"\n                     },\n                     \"route\": {\n                       \"cluster\": \"local_service\"\n                     }\n                    }\n                  ]\n                 }\n               ]\n              }\n             ,\n              \"httpFilters\": \n              [\n                {\n                  \"name\": \"istio.basic_auth\",\n                  \"typed_config\": {\n                    \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                    \"type_url\": \"type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm\",\n                    \"value\": {\n                      \"config\": {\n                        \"configuration\": {\n                          \"@type\": \"type.googleapis.com/google.protobuf.StringValue\",\n                          \"value\": \"{\\n  \\\"basic_auth_rules\\\": [\\n    {\\n      \\\"prefix\\\": \\\"/productpage\\\",\\n      \\\"request_methods\\\":[ \\\"GET\\\", \\\"POST\\\" ],\\n      \\\"credentials\\\":[ \\\"ok:test\\\", \\\"YWRtaW4zOmFkbWluMw==\\\" ]\\n    }\\n  ]\\n}\\n\"\n                        },\n                        \"vm_config\": {\n                          \"vm_id\": \"basic_auth\",\n                          \"code\": {\n                            \"local\": {\n                              \"filename\": \"/tmp/basic-auth.wasm\"\n                            }\n                          },\n                          \"runtime\": \"envoy.wasm.runtime.v8\"\n                        }\n                      }\n                    }\n                  }\n                },\n                {\n                  \"name\": \"envoy.filters.http.router\",\n                  \"typedConfig\": {\n                    \"@type\": \"type.googleapis.com/envoy.extensions.filters.http.router.v3.Router\"\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    ]\n    }\n  ],\n  \"clusters\": [\n    {\n        \"name\": \"local_service\",\n        \"type\": \"STATIC\",\n        \"lb_policy\": \"ROUND_ROBIN\",\n        \"loadAssignment\": {\n            \"clusterName\": \"local_service\",\n            \"endpoints\": [\n                {\n                    \"lbEndpoints\": [\n                        {\n                            \"endpoint\": {\n                                \"address\": {\n                                    \"socketAddress\": {\n                                        \"address\": \"127.0.0.1\",\n                                        \"portValue\": 80\n                                    }\n                                }\n                            }\n                        }\n                    ]\n                }\n            ]\n        }\n    },\n    {\n        \"name\": \"remote_wasm\",\n        \"type\": \"STRICT_DNS\",\n        \"connect_timeout\": \"1s\",\n        \"dns_refresh_rate\": \"5s\",\n        \"dns_lookup_family\": \"v4_only\",\n        \"load_assignment\": {\n          \"cluster_name\": \"remote_wasm\",\n          \"endpoints\": [\n            {\n              \"lb_endpoints\": [\n                {\n                  \"endpoint\": {\n                    \"address\": {\n                      \"socket_address\": {\n                        \"address\": \"github.com\",\n                        \"port_value\": 443\n                      }\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        \"transport_socket\": {\n          \"name\": \"envoy.transport_sockets.tls\",\n          \"typed_config\": {\n            \"@type\": \"type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext\",\n            \"sni\": \"github.com\"\n          }\n        }\n      }\n    ]\n}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"istio-custom-bootstrap-config","namespace":"test"}}
  creationTimestamp: "2024-05-08T21:04:30Z"
  name: istio-custom-bootstrap-config
  namespace: test
  resourceVersion: "13835575"
  uid: 24b65f81-a20f-4b65-acd7-9cc56733646b
